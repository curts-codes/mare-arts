<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Order Summary</title>

  <link rel="stylesheet" href="styles/style.css"/>

</head>
<body>
  <header>
    <div class="logo">Mare Arts</div>
  <nav>
  <ul id="nav-menu">
    <li><a href="index.html">Home</a></li>
    <li><a href="shop.html">Shop</a></li>
    <li><a href="cart.html">Cart (<span id="cart-count">0</span>)</a></li>
  </ul>
</nav>


  </header>

  <main class="order-summary-container">
    <h1>Order Summary</h1>

    <section class="order-grid">
      <div class="customer-info">
        <h2>Customer Information</h2>
        <label for="name">Full Name:</label>
        <input type="text" id="name" class="form-input" required>

        <label for="email">Email:</label>
        <input type="email" id="email" class="form-input" required>

       <label for="street">Street Address:</label>
<input type="text" id="street" class="form-input" required />

<label for="city">City:</label>
<input type="text" id="city" class="form-input" required />

<label for="zip">ZIP Code:</label>
<input type="text" id="zip" class="form-input" required />


      </div>

      <div class="summary-box">
        <h2>Your Items</h2>
        <ul id="summary-items"></ul>
        <div id="summary-total" class="cart-total"></div>
      </div>
    </section>

    <button class="place-order-btn" onclick="placeOrder()">Place Order</button>
  </main>

  <footer>
    <p>Â© 2025 Mare Arts</p>
  </footer>

  <script>
    const summaryList = document.getElementById('summary-items');
    const totalDiv = document.getElementById('summary-total');

    function renderSummary() {
      const cartItems = JSON.parse(localStorage.getItem('cart')) || [];

      if (cartItems.length === 0) {
        summaryList.innerHTML = '<li>Your cart is empty.</li>';
        totalDiv.textContent = '';
        return;
      }

      let total = 0;
      cartItems.forEach(item => {
        total += item.price * item.quantity;
        const li = document.createElement('li');
        li.textContent = `${item.name} - $${item.price.toFixed(2)} x ${item.quantity}`;
        summaryList.appendChild(li);
      });

      totalDiv.innerHTML = `<p>Total: $${total.toFixed(2)}</p>`;
    }

    function placeOrder() {
  const name = document.getElementById('name').value.trim();
  const email = document.getElementById('email').value.trim();
  const street = document.getElementById('street').value.trim();
const city = document.getElementById('city').value.trim();
const zip = document.getElementById('zip').value.trim();

const address = `${street}, ${city}, ${zip}`;


  if (!name || !email || !address) {
    alert('Please fill out all customer info fields.');
    return;
  }

  const loggedInEmail = localStorage.getItem('loggedInUser');
  if (!loggedInEmail) {
    alert('Please log in to place an order.');
    window.location.href = 'account.html';
    return;
  }

  const userKey = `user-${loggedInEmail}`;
  const userData = JSON.parse(localStorage.getItem(userKey));
  if (!userData) {
    alert('Account not found. Please log in again.');
    localStorage.removeItem('loggedInUser');
    window.location.href = 'account.html';
    return;
  }

  const cartItems = JSON.parse(localStorage.getItem('cart')) || [];

  const newOrder = {
    id: Date.now(),
    items: cartItems,
    total: cartItems.reduce((sum, item) => sum + item.price * item.quantity, 0),
    shippingInfo: {name, email, address},
    date: new Date().toLocaleString(),
  };

  userData.orders.push(newOrder);
  localStorage.setItem(userKey, JSON.stringify(userData));

  alert(`Order placed successfully! Thank you, ${userData.name}.`);

  localStorage.removeItem('cart');
  window.location.href = 'index.html';
}


    renderSummary();
   const loggedInEmail = localStorage.getItem("loggedInUser");

if (loggedInEmail) {
  const userData = JSON.parse(localStorage.getItem(`user-${loggedInEmail}`));

  document.getElementById("name").value = userData?.name || "";
  document.getElementById("email").value = userData?.email || "";

  const shipping = userData?.shipping;
  if (shipping) {
    document.getElementById("street").value = shipping.address || "";
    document.getElementById("city").value = shipping.city || "";
    document.getElementById("zip").value = shipping.zip || "";
  }
}



  function logout() {
    localStorage.removeItem('loggedInUser');
    alert('You have been logged out.');
    window.location.href = 'index.html';
  }
  window.addEventListener('DOMContentLoaded', () => {
  const loggedIn = localStorage.getItem('loggedInUser');
  if (!loggedIn) {
    document.querySelector("a[href='my-orders.html']").style.display = 'none';
    document.querySelector("a[onclick='logout()']").style.display = 'none';
  }
});


  </script>
<script>
  const email = localStorage.getItem("loggedInUser");
const nav = document.getElementById("nav-menu");

if (email) {
  const userData = JSON.parse(localStorage.getItem(`user-${email}`));
  const name = userData?.name || email;

  const userItem = document.createElement("li");
  userItem.textContent = `Welcome, ${name}`;

  const logoutItem = document.createElement("li");
  logoutItem.innerHTML = `<a href="#" id="logout-btn">Logout</a>`;

  nav.append(userItem, logoutItem);

  document.getElementById("logout-btn").addEventListener("click", () => {
    localStorage.removeItem("loggedInUser");
    window.location.reload();
  });


  } else {
    const loginItem = document.createElement("li");
    loginItem.innerHTML = `<a href="account.html">Login</a>
`;
    nav.appendChild(loginItem);
  }
</script>

</body>
</html>
