<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Manage Product Catalog</title>
  <link rel="stylesheet" href="styles/style.css" />
</head>
<body>
  <header>
    <div class="logo">Mare Arts Admin</div>
    <nav>
      <ul>
        <li><a href="admin.html">Dashboard</a></li>
        <li><a href="#" onclick="logout()">Logout</a></li>
      </ul>
    </nav>
  </header>

  <main>
    <h1>Catalog Management</h1>
    <div id="admin-warning" style="color: red;"></div>

    <section>
      <h2>Products</h2>
      <div id="product-list"></div>
    </section>

    <section style="margin-top: 2em;">
      <h2>Add New Product</h2>
      <form id="add-form">
        <label for="new-name">Product Name:</label>
        <input type="text" id="new-name" required>

        <label for="new-price">Price:</label>
        <input type="number" id="new-price" step="0.01" required>

        <label for="new-image">Image URL:</label>
        <input type="text" id="new-image" placeholder="e.g. images/mug.png">

        <button type="submit">Add Product</button>
      </form>
    </section>
  </main>

  <footer>
    <p>Â© 2025 Mare Arts</p>
  </footer>

  <script>
  document.addEventListener("DOMContentLoaded", () => {
    const adminEmail = "admin@marearts.com";
    const currentUser = localStorage.getItem("currentUser");

    console.log("Logged in as:", currentUser);

    const warning = document.getElementById("admin-warning");
    const productList = document.getElementById("product-list");
    const addForm = document.getElementById("add-form");

    if (currentUser !== adminEmail) {
      if (warning) warning.textContent = "Access denied. Admin only.";
      if (productList) productList.style.display = "none";
      if (addForm) addForm.style.display = "none";
      return;
    }

    renderProducts();

    addForm.addEventListener("submit", function(e) {
      e.preventDefault();

      const name = document.getElementById("new-name").value.trim();
      const price = parseFloat(document.getElementById("new-price").value);
      const image = document.getElementById("new-image").value.trim();

      if (!name || isNaN(price)) {
        alert("Please fill out the form with valid values.");
        return;
      }

      const products = getProducts();
      const newProduct = {
        id: Date.now(),
        name,
        price,
        image
      };

      products.push(newProduct);
      saveProducts(products);
      addForm.reset();
    });
  });

  function getProducts() {
    return JSON.parse(localStorage.getItem("products")) || [];
  }

  function saveProducts(products) {
    localStorage.setItem("products", JSON.stringify(products));
    renderProducts();
  }

  function renderProducts() {
    const products = getProducts();
    const productList = document.getElementById("product-list");
    productList.innerHTML = "";

    if (products.length === 0) {
      productList.innerHTML = "<p>No products in the catalog.</p>";
      return;
    }

    products.forEach((product, index) => {
      const div = document.createElement("div");
      div.style.border = "1px solid #ccc";
      div.style.padding = "1em";
      div.style.marginBottom = "1em";
      div.style.borderRadius = "6px";

      div.innerHTML = `
        <p><strong>Name:</strong> <input type="text" value="${product.name}" id="name-${index}" /></p>
        <p><strong>Price:</strong> $<input type="number" step="0.01" value="${product.price}" id="price-${index}" /></p>
        <p><strong>Image:</strong> ${product.image ? `<img src="${product.image}" style="height:60px;">` : "No image"}</p>
        <button onclick="updateProduct(${index})">Save Changes</button>
        <button onclick="deleteProduct(${index})" style="color:red;">Delete</button>
      `;

      productList.appendChild(div);
    });
  }

  function updateProduct(index) {
    const products = getProducts();
    const name = document.getElementById(`name-${index}`).value.trim();
    const price = parseFloat(document.getElementById(`price-${index}`).value);

    if (!name || isNaN(price)) {
      alert("Please enter valid product info.");
      return;
    }

    products[index].name = name;
    products[index].price = price;
    saveProducts(products);
  }

  function deleteProduct(index) {
    const products = getProducts();
    if (confirm("Are you sure you want to delete this product?")) {
      products.splice(index, 1);
      saveProducts(products);
    }
  }

  function logout() {
    localStorage.removeItem("currentUser");
    window.location.href = "index.html";
  }
</script>

</body>
</html>
